import { Link } from "react-router-dom";
import { useCompare } from "../context/CompareContext";
import { useState, useEffect } from "react";
import { LuMoonStar, LuSun, LuGitCompare, LuGamepad } from "react-icons/lu";

function useDarkMode() {
  useEffect(() => {
    const saved = localStorage.getItem("theme");
    const shouldBeDark =
      saved === "dark" ||
      (!saved && window.matchMedia("(prefers-color-scheme: dark)").matches);

    if (shouldBeDark) {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }
  }, []);

  const toggle = () => {
    const isDarkNow = document.documentElement.classList.toggle("dark");
    localStorage.setItem("theme", isDarkNow ? "dark" : "light");
  };

  return toggle;
}

const Navbar = () => {
  const { compareList } = useCompare();
  const [scale, setScale] = useState(false);
  const toggleDark = useDarkMode();

  // slide-toggle state
  const [isDark, setIsDark] = useState(false);

  const lightLogo = (
    <svg
      className="md:w-32 w-24"
      viewBox="0 0 165 30"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <g clipPath="url(#clip0_61_7188)">
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M114.199 11.1249C108.67 11.1249 104.167 15.6185 104.167 21.1891C104.167 21.5527 104.461 21.8477 104.824 21.8477C108.861 21.8477 112.378 19.4397 113.966 15.9478C114.014 15.8311 114.11 15.7763 114.199 15.7763C114.294 15.7763 114.39 15.8311 114.438 15.9478C116.026 19.4397 119.536 21.8477 123.58 21.8477C123.943 21.8477 124.237 21.5527 124.237 21.1891C124.237 15.6185 119.727 11.1249 114.199 11.1249ZM107.452 19.5907C107.171 19.8788 106.699 19.8788 106.411 19.5907C106.124 19.3025 106.124 18.836 106.411 18.5479C106.699 18.2597 107.164 18.2597 107.452 18.5479C107.739 18.836 107.739 19.3025 107.452 19.5907ZM110.777 17.5805C110.127 18.2323 109.066 18.2392 108.416 17.5805C107.766 16.9288 107.759 15.8723 108.416 15.2137C109.066 14.562 110.12 14.562 110.777 15.2137C111.427 15.8654 111.427 16.9288 110.777 17.5805ZM112.775 14.2464C112.488 14.5345 112.023 14.5345 111.735 14.2464C111.448 13.9582 111.448 13.4917 111.735 13.2036C112.023 12.9155 112.488 12.9155 112.775 13.2036C113.063 13.4917 113.063 13.9582 112.775 14.2464ZM116.669 14.2464C116.381 14.5345 115.916 14.5345 115.629 14.2464C115.341 13.9582 115.341 13.4917 115.629 13.2036C115.909 12.9155 116.381 12.9155 116.669 13.2036C116.956 13.4917 116.956 13.9582 116.669 14.2464ZM119.988 17.5805C119.337 18.2323 118.284 18.2392 117.627 17.5805C116.977 16.9288 116.977 15.8723 117.627 15.2137C118.277 14.562 119.331 14.562 119.988 15.2137C120.638 15.8654 120.638 16.9288 119.988 17.5805ZM121.986 19.5907C121.698 19.8788 121.233 19.8788 120.945 19.5907C120.658 19.3025 120.658 18.836 120.945 18.5479C121.233 18.2597 121.698 18.2597 121.986 18.5479C122.273 18.836 122.273 19.3025 121.986 19.5907Z"
          fill="#EAB308"
        />
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M122.779 23.0792C120.782 32.2303 107.62 32.2303 105.623 23.0792C109.114 22.8308 112.275 20.9703 114.2 18.093C116.126 20.9703 119.287 22.8315 122.779 23.0792Z"
          fill="#2563EB"
        />
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M115.002 6.16204C116.292 3.1558 119.46 0.688101 122.788 0.638706C123.134 0.633217 123.42 0.911751 123.425 1.2582C123.43 1.60466 123.152 1.89142 122.807 1.89622C120.034 1.93739 117.345 4.03051 116.216 6.52084C117.961 7.28921 119.186 9.02353 119.218 11.0487C116.079 9.48455 112.323 9.48455 109.184 11.0487C109.216 9.02353 110.44 7.28853 112.185 6.52084C111.054 4.02913 108.368 1.93807 105.595 1.89622C105.249 1.89074 104.972 1.60466 104.977 1.2582C104.983 0.911751 105.268 0.633904 105.613 0.638706C108.933 0.688101 112.107 3.14894 113.399 6.16204C113.929 6.07629 114.472 6.07629 115.002 6.16204Z"
          fill="#2563EB"
        />
        <path
          d="M12.3264 4.13341C14.7597 4.13341 16.8078 4.9546 18.4699 6.59699C20.132 8.24006 20.9634 10.2557 20.9634 12.6472C20.9634 15.0374 20.132 17.0544 18.4699 18.6967C16.8078 20.3391 14.7597 21.1603 12.3264 21.1603H7.88204V29.493H2.89502V4.13341H12.3264ZM12.3264 16.487C13.3864 16.487 14.2657 16.1193 14.9643 15.3825C15.663 14.6457 16.0119 13.7346 16.0119 12.6479C16.0119 11.5372 15.6623 10.6186 14.9643 9.89411C14.2657 9.16897 13.3857 8.80742 12.3264 8.80742H7.88204V16.487H12.3264Z"
          fill="#0F172A"
        />
        <path
          d="M28.2626 14.4947C28.6964 13.3353 29.4128 12.4661 30.4126 11.8864C31.4123 11.306 32.527 11.0165 33.7553 11.0165V16.2332C32.334 16.0651 31.0633 16.3553 29.9432 17.1031C28.823 17.8522 28.2633 19.0953 28.2633 20.8344V29.493H23.6006V11.3787H28.2619V14.4947H28.2626Z"
          fill="#0F172A"
        />
        <path
          d="M38.7772 9.20533C38.006 9.20533 37.3374 8.922 36.7716 8.35464C36.2057 7.78728 35.9224 7.11633 35.9224 6.34316C35.9224 5.57068 36.2057 4.89492 36.7716 4.31453C37.3374 3.73482 38.006 3.44463 38.7772 3.44463C39.5723 3.44463 40.2525 3.73482 40.8184 4.31453C41.3843 4.89492 41.6676 5.57068 41.6676 6.34316C41.6676 7.11633 41.3843 7.7866 40.8184 8.35464C40.2525 8.92268 39.5723 9.20533 38.7772 9.20533ZM36.4643 29.493V11.3787H41.1256V29.493H36.4643Z"
          fill="#0F172A"
        />
        <path
          d="M53.9892 30C51.2665 30 48.9967 29.0828 47.1779 27.2469C45.3591 25.4111 44.4497 23.1409 44.4497 20.4359C44.4497 17.7308 45.3591 15.4607 47.1779 13.6248C48.9967 11.789 51.2672 10.871 53.9892 10.871C55.7471 10.871 57.3497 11.2937 58.7949 12.1389C60.2401 12.9841 61.3363 14.1195 62.0836 15.5451L58.073 17.8996C57.7117 17.1511 57.1629 16.5597 56.4287 16.1241C55.6938 15.6898 54.8692 15.4723 53.9536 15.4723C52.5563 15.4723 51.4006 15.9382 50.485 16.8671C49.5688 17.7967 49.1117 18.9863 49.1117 20.4359C49.1117 21.8608 49.5688 23.038 50.485 23.9676C51.4006 24.8972 52.5563 25.3623 53.9536 25.3623C54.8932 25.3623 55.73 25.1504 56.4649 24.7278C57.1992 24.3058 57.748 23.7193 58.1093 22.9701L62.1561 25.2896C61.361 26.7145 60.2408 27.8554 58.7956 28.713C57.3504 29.5705 55.7478 30 53.9892 30Z"
          fill="#0F172A"
        />
        <path
          d="M68.2634 22.3568C68.8895 24.6269 70.5872 25.7616 73.3578 25.7616C75.1397 25.7616 76.4891 25.1586 77.4047 23.9498L81.1627 26.1239C79.3802 28.7089 76.7546 30 73.2853 30C70.2977 30 67.9014 29.0944 66.0942 27.2833C64.287 25.4714 63.3838 23.189 63.3838 20.4366C63.3838 17.7068 64.2754 15.4305 66.058 13.607C67.8398 11.7842 70.1287 10.8724 72.9233 10.8724C75.5728 10.8724 77.7591 11.7903 79.4821 13.6262C81.2044 15.4621 82.0653 17.7315 82.0653 20.4372C82.0653 21.041 82.0051 21.6804 81.8846 22.3575L68.2634 22.3568ZM68.1902 18.7331H77.4047C77.1392 17.5017 76.5917 16.5837 75.761 15.9793C74.9296 15.3763 73.9839 15.0738 72.924 15.0738C71.6711 15.0738 70.6351 15.3941 69.8167 16.0342C68.9976 16.6743 68.4557 17.5744 68.1902 18.7331Z"
          fill="#0F172A"
        />
        <path
          d="M94.9659 4.13341C97.3992 4.13341 99.4472 4.9546 101.109 6.59699C102.771 8.24006 103.603 10.2557 103.603 12.6472C103.603 15.0374 102.771 17.0544 101.109 18.6967C99.4472 20.3391 97.3992 21.1603 94.9659 21.1603H90.5215V29.493H85.5352V4.13341H94.9659ZM94.9659 16.487C96.0258 16.487 96.9051 16.1193 97.6038 15.3825C98.3024 14.6457 98.6514 13.7346 98.6514 12.6479C98.6514 11.5372 98.3017 10.6186 97.6038 9.89411C96.9051 9.16897 96.0251 8.80742 94.9659 8.80742H90.5215V16.487H94.9659Z"
          fill="#0F172A"
        />
        <path
          d="M143.568 29.493H138.148L131.571 21.2632V29.493H126.91V4.13341H131.571V19.3807L137.787 11.3787H143.351L136.088 20.3275L143.568 29.493Z"
          fill="#0F172A"
        />
        <path
          d="M158.311 11.3787H162.972V29.493H158.311V27.356C156.914 29.1191 154.951 30 152.421 30C150.012 30 147.946 29.0759 146.224 27.2284C144.501 25.3809 143.64 23.1169 143.64 20.4366C143.64 17.7555 144.502 15.4909 146.224 13.6434C147.946 11.7958 150.011 10.8724 152.421 10.8724C154.951 10.8724 156.914 11.754 158.311 13.5164V11.3787ZM149.71 24.1131C150.65 25.0673 151.842 25.5442 153.288 25.5442C154.734 25.5442 155.931 25.0673 156.884 24.1131C157.835 23.1588 158.311 21.9335 158.311 20.4366C158.311 18.9382 157.835 17.7136 156.884 16.7594C155.931 15.8051 154.733 15.3283 153.288 15.3283C151.843 15.3283 150.651 15.8051 149.71 16.7594C148.771 17.7143 148.301 18.9389 148.301 20.4366C148.301 21.9335 148.771 23.1588 149.71 24.1131Z"
          fill="#0F172A"
        />
      </g>
      <defs>
        <clipPath id="clip0_61_7188">
          <rect width="165" height="30" fill="white" />
        </clipPath>
      </defs>
    </svg>
  );
  const darkLogo = (
    <svg
      className="md:w-32 w-24"
      viewBox="0 0 165 30"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <g clipPath="url(#clip0_61_7188)">
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M114.199 11.1249C108.67 11.1249 104.167 15.6185 104.167 21.1891C104.167 21.5527 104.461 21.8477 104.824 21.8477C108.861 21.8477 112.378 19.4397 113.966 15.9478C114.014 15.8311 114.11 15.7763 114.199 15.7763C114.294 15.7763 114.39 15.8311 114.438 15.9478C116.026 19.4397 119.536 21.8477 123.58 21.8477C123.943 21.8477 124.237 21.5527 124.237 21.1891C124.237 15.6185 119.727 11.1249 114.199 11.1249ZM107.452 19.5907C107.171 19.8788 106.699 19.8788 106.411 19.5907C106.124 19.3025 106.124 18.836 106.411 18.5479C106.699 18.2597 107.164 18.2597 107.452 18.5479C107.739 18.836 107.739 19.3025 107.452 19.5907ZM110.777 17.5805C110.127 18.2323 109.066 18.2392 108.416 17.5805C107.766 16.9288 107.759 15.8723 108.416 15.2137C109.066 14.562 110.12 14.562 110.777 15.2137C111.427 15.8654 111.427 16.9288 110.777 17.5805ZM112.775 14.2464C112.488 14.5345 112.023 14.5345 111.735 14.2464C111.448 13.9582 111.448 13.4917 111.735 13.2036C112.023 12.9155 112.488 12.9155 112.775 13.2036C113.063 13.4917 113.063 13.9582 112.775 14.2464ZM116.669 14.2464C116.381 14.5345 115.916 14.5345 115.629 14.2464C115.341 13.9582 115.341 13.4917 115.629 13.2036C115.909 12.9155 116.381 12.9155 116.669 13.2036C116.956 13.4917 116.956 13.9582 116.669 14.2464ZM119.988 17.5805C119.337 18.2323 118.284 18.2392 117.627 17.5805C116.977 16.9288 116.977 15.8723 117.627 15.2137C118.277 14.562 119.331 14.562 119.988 15.2137C120.638 15.8654 120.638 16.9288 119.988 17.5805ZM121.986 19.5907C121.698 19.8788 121.233 19.8788 120.945 19.5907C120.658 19.3025 120.658 18.836 120.945 18.5479C121.233 18.2597 121.698 18.2597 121.986 18.5479C122.273 18.836 122.273 19.3025 121.986 19.5907Z"
          fill="#EAB308"
        />
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M122.779 23.0792C120.782 32.2303 107.62 32.2303 105.623 23.0792C109.114 22.8308 112.275 20.9703 114.2 18.093C116.126 20.9703 119.287 22.8315 122.779 23.0792Z"
          fill="#2563EB"
        />
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M115.002 6.16204C116.292 3.1558 119.46 0.688101 122.788 0.638706C123.134 0.633217 123.42 0.911751 123.425 1.2582C123.43 1.60466 123.152 1.89142 122.807 1.89622C120.034 1.93739 117.345 4.03051 116.216 6.52084C117.961 7.28921 119.186 9.02353 119.218 11.0487C116.079 9.48455 112.323 9.48455 109.184 11.0487C109.216 9.02353 110.44 7.28853 112.185 6.52084C111.054 4.02913 108.368 1.93807 105.595 1.89622C105.249 1.89074 104.972 1.60466 104.977 1.2582C104.983 0.911751 105.268 0.633904 105.613 0.638706C108.933 0.688101 112.107 3.14894 113.399 6.16204C113.929 6.07629 114.472 6.07629 115.002 6.16204Z"
          fill="#2563EB"
        />
        <path
          d="M12.3264 4.13341C14.7597 4.13341 16.8078 4.9546 18.4699 6.59699C20.132 8.24006 20.9634 10.2557 20.9634 12.6472C20.9634 15.0374 20.132 17.0544 18.4699 18.6967C16.8078 20.3391 14.7597 21.1603 12.3264 21.1603H7.88204V29.493H2.89502V4.13341H12.3264ZM12.3264 16.487C13.3864 16.487 14.2657 16.1193 14.9643 15.3825C15.663 14.6457 16.0119 13.7346 16.0119 12.6479C16.0119 11.5372 15.6623 10.6186 14.9643 9.89411C14.2657 9.16897 13.3857 8.80742 12.3264 8.80742H7.88204V16.487H12.3264Z"
          fill="#FFFF"
        />
        <path
          d="M28.2626 14.4947C28.6964 13.3353 29.4128 12.4661 30.4126 11.8864C31.4123 11.306 32.527 11.0165 33.7553 11.0165V16.2332C32.334 16.0651 31.0633 16.3553 29.9432 17.1031C28.823 17.8522 28.2633 19.0953 28.2633 20.8344V29.493H23.6006V11.3787H28.2619V14.4947H28.2626Z"
          fill="#FFFF"
        />
        <path
          d="M38.7772 9.20533C38.006 9.20533 37.3374 8.922 36.7716 8.35464C36.2057 7.78728 35.9224 7.11633 35.9224 6.34316C35.9224 5.57068 36.2057 4.89492 36.7716 4.31453C37.3374 3.73482 38.006 3.44463 38.7772 3.44463C39.5723 3.44463 40.2525 3.73482 40.8184 4.31453C41.3843 4.89492 41.6676 5.57068 41.6676 6.34316C41.6676 7.11633 41.3843 7.7866 40.8184 8.35464C40.2525 8.92268 39.5723 9.20533 38.7772 9.20533ZM36.4643 29.493V11.3787H41.1256V29.493H36.4643Z"
          fill="#FFFF"
        />
        <path
          d="M53.9892 30C51.2665 30 48.9967 29.0828 47.1779 27.2469C45.3591 25.4111 44.4497 23.1409 44.4497 20.4359C44.4497 17.7308 45.3591 15.4607 47.1779 13.6248C48.9967 11.789 51.2672 10.871 53.9892 10.871C55.7471 10.871 57.3497 11.2937 58.7949 12.1389C60.2401 12.9841 61.3363 14.1195 62.0836 15.5451L58.073 17.8996C57.7117 17.1511 57.1629 16.5597 56.4287 16.1241C55.6938 15.6898 54.8692 15.4723 53.9536 15.4723C52.5563 15.4723 51.4006 15.9382 50.485 16.8671C49.5688 17.7967 49.1117 18.9863 49.1117 20.4359C49.1117 21.8608 49.5688 23.038 50.485 23.9676C51.4006 24.8972 52.5563 25.3623 53.9536 25.3623C54.8932 25.3623 55.73 25.1504 56.4649 24.7278C57.1992 24.3058 57.748 23.7193 58.1093 22.9701L62.1561 25.2896C61.361 26.7145 60.2408 27.8554 58.7956 28.713C57.3504 29.5705 55.7478 30 53.9892 30Z"
          fill="#FFFF"
        />
        <path
          d="M68.2634 22.3568C68.8895 24.6269 70.5872 25.7616 73.3578 25.7616C75.1397 25.7616 76.4891 25.1586 77.4047 23.9498L81.1627 26.1239C79.3802 28.7089 76.7546 30 73.2853 30C70.2977 30 67.9014 29.0944 66.0942 27.2833C64.287 25.4714 63.3838 23.189 63.3838 20.4366C63.3838 17.7068 64.2754 15.4305 66.058 13.607C67.8398 11.7842 70.1287 10.8724 72.9233 10.8724C75.5728 10.8724 77.7591 11.7903 79.4821 13.6262C81.2044 15.4621 82.0653 17.7315 82.0653 20.4372C82.0653 21.041 82.0051 21.6804 81.8846 22.3575L68.2634 22.3568ZM68.1902 18.7331H77.4047C77.1392 17.5017 76.5917 16.5837 75.761 15.9793C74.9296 15.3763 73.9839 15.0738 72.924 15.0738C71.6711 15.0738 70.6351 15.3941 69.8167 16.0342C68.9976 16.6743 68.4557 17.5744 68.1902 18.7331Z"
          fill="#FFFF"
        />
        <path
          d="M94.9659 4.13341C97.3992 4.13341 99.4472 4.9546 101.109 6.59699C102.771 8.24006 103.603 10.2557 103.603 12.6472C103.603 15.0374 102.771 17.0544 101.109 18.6967C99.4472 20.3391 97.3992 21.1603 94.9659 21.1603H90.5215V29.493H85.5352V4.13341H94.9659ZM94.9659 16.487C96.0258 16.487 96.9051 16.1193 97.6038 15.3825C98.3024 14.6457 98.6514 13.7346 98.6514 12.6479C98.6514 11.5372 98.3017 10.6186 97.6038 9.89411C96.9051 9.16897 96.0251 8.80742 94.9659 8.80742H90.5215V16.487H94.9659Z"
          fill="#FFFF"
        />
        <path
          d="M143.568 29.493H138.148L131.571 21.2632V29.493H126.91V4.13341H131.571V19.3807L137.787 11.3787H143.351L136.088 20.3275L143.568 29.493Z"
          fill="#FFFF"
        />
        <path
          d="M158.311 11.3787H162.972V29.493H158.311V27.356C156.914 29.1191 154.951 30 152.421 30C150.012 30 147.946 29.0759 146.224 27.2284C144.501 25.3809 143.64 23.1169 143.64 20.4366C143.64 17.7555 144.502 15.4909 146.224 13.6434C147.946 11.7958 150.011 10.8724 152.421 10.8724C154.951 10.8724 156.914 11.754 158.311 13.5164V11.3787ZM149.71 24.1131C150.65 25.0673 151.842 25.5442 153.288 25.5442C154.734 25.5442 155.931 25.0673 156.884 24.1131C157.835 23.1588 158.311 21.9335 158.311 20.4366C158.311 18.9382 157.835 17.7136 156.884 16.7594C155.931 15.8051 154.733 15.3283 153.288 15.3283C151.843 15.3283 150.651 15.8051 149.71 16.7594C148.771 17.7143 148.301 18.9389 148.301 20.4366C148.301 21.9335 148.771 23.1588 149.71 24.1131Z"
          fill="#FFFF"
        />
      </g>
      <defs>
        <clipPath id="clip0_61_7188">
          <rect width="165" height="30" fill="white" />
        </clipPath>
      </defs>
    </svg>
  );

  // init isDark from localStorage on mount
  useEffect(() => {
    const savedTheme = localStorage.getItem("theme");
    const shouldBeDark =
      savedTheme === "dark" ||
      (!savedTheme &&
        window.matchMedia("(prefers-color-scheme: dark)").matches);
    setIsDark(shouldBeDark);
  }, []);

  // handle click: toggle html class + slide toggle
  const handleToggle = () => {
    toggleDark();
    setIsDark((d) => !d);
  };

  // bump effect for compare button
  useEffect(() => {
    if (compareList.length > 0) {
      setScale(true);
      const timer = setTimeout(() => setScale(false), 300);
      return () => clearTimeout(timer);
    }
  }, [compareList.length]);

  return (
    <nav className="bg-gray-100 shadow-md sticky top-0 z-50 dark:bg-[#020817] dark:border-b dark:border-[#1e293b]">
      <div className="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
        <Link to="/" className="text-xl font-bold text-blue-600">
          {isDark ? darkLogo : lightLogo}
        </Link>
        <div className="flex gap-4 items-center ">
          <button
            className=" rounded-full p-2  border dark:border-[#1e293b] border-gray-300 flex items-center transition duration-300 text-gray-500 text-xl  hover:text-white hover:bg-blue-600"
            onClick={handleToggle}
          >
            {isDark ? <LuMoonStar /> : <LuSun />}
          </button>

          <Link
            to="/compare"
            className={`md-hide inline-flex items-center border border-blue-600 text-blue-600 py-2 px-4 rounded-sm font-medium md:text-md text-sm transition-all duration-300 ease-in-out hover:bg-blue-600 hover:text-white  ${
              scale ? "transform scale-105 " : ""
            }`}
          >
            <span className="md:mr-2 mr-0">
              <LuGitCompare className="text-xl" />
            </span>
            <span className="hidden md:block">Compare</span>
            {compareList.length > 0 && `(${compareList.length})`}
          </Link>
          <Link
            to="/gaming-pc"
            className="md-hide inline-flex items-center border border-blue-600 text-blue-600 py-2 px-4 rounded-sm font-medium md:text-md text-sm transition-all duration-300 ease-in-out hover:bg-blue-600 hover:text-white"
          >
            <span className="md:mr-2 mr-0">
              <LuGamepad className="text-xl" />
            </span>
            <span className="hidden md:block">Gaming PCs</span>
          </Link>
        </div>
      </div>
    </nav>
  );
};

export default Navbar;
